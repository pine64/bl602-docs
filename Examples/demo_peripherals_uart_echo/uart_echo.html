

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>17. UART_echo &mdash; BL602 IoT SDK (Pine64 fork)  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://pine64.github.io/bl602-docs/Examples/demo_peripherals_uart_echo/uart_echo.html" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="18. UART_ioctl" href="../demo_peripherals_uart_ioctl/uart_ioctl.html" />
    <link rel="prev" title="16. GPIO" href="../demo_peripherals_gpio/GPIO.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BL602 IoT SDK (Pine64 fork)
          

          
          </a>

          
            
            
              <div class="version">
                release_bl_iot_sdk_1.6.11-1-g66bb28da-pine64
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Quickstart_Guide/get_started.html">1. Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Quickstart_Guide/Linux/Quickstart_Linux_ubuntu.html">2. Linux Starter Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Quickstart_Guide/Windows/Quickstart_Windows_msys.html">3. Windows Starter Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Environment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Developer_Environment/Setting_Up.html">1. Developer Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer_Environment/BLFlashEnv/BLFlashEnv.html">2. BLFlashEnv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer_Environment/freedom_studio/freedom_studio.html">3. Freedom Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer_Environment/eclipse/eclipse.html">4. Eclipse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer_Environment/openocd/openocd.html">5. openocd</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../README.html">1. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helloworld/helloworld.html">2. Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_aws/aws.html">3. AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_at/AT.html">4. AT Commands Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_at/AT.html#basic-at-commands">5. Basic AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_at/AT.html#wi-fi-at-commands">6. Wi-Fi AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_at/AT.html#tcp-ip-at-commands">7. TCP/IP AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_at/AT.html#ble-at-commands">8. BLE AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_audio_udp/audio_udp.html">9. AUDIO UDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_ble/ble.html">10. BLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_blsync_ble/blsync_ble.html">11. BLSYNC-BLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_cronalarm/cronalarm.html">12. cronalarm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_dac/DAC.html">13. DAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_hbnram/hbnram.html">14. HBNRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_mesh/mesh.html">15. Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_peripherals_gpio/GPIO.html">16. GPIO</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">17. UART_echo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">17.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-steps">17.2. Usage Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-examples">17.3. Code Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../demo_peripherals_uart_ioctl/uart_ioctl.html">18. UART_ioctl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_protocols_http/http.html">19. Http client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_protocols_httpc/httpc.html">20. Httpc client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_storage_psm/psm.html">21. PSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_storage_romfs/romfs.html">22. Romfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_system_cli/cli.html">23. cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_system_fdt/fdt.html">24. FDT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_wifi/wifi.html">25. Wi-Fi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo_zb/zigbee.html">26. Zigbee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdk_app_easyflash_boottimes/easyflash_boottimes.html">27. Easyflash4 boot times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdk_app_pwm/pwm.html">28. Pwm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark_security_aes/benchmark_security_aes_gcm.html">29. AES-GCM</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Components/arch.html">1. arch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Command_line/helper.html">2. helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Command_line/aos_cli.html">3. cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Hal_drv/gpio.html">4. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/bloop/bloop.html">5. BLOOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/blsync/blsync.html">6. BLSYNC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/dts/devicetree.html">7. device tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/log/blog.html">8. blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/security/security.html">9. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/vfs/vfs.html">10. AOS VFS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Middleware/yloop/yloop.html">11. yloop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Network/httpc/httpc.html">12. HTTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Network/https/https.html">13. HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Network/tls/tls.html">14. TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/Network/wifi/wifi.html">15. WiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/BLE/provision_WiFi/provision_WiFi.html">16. Provision_WiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/BLE/mesh/mesh.html">17. Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Components/BLE/ble_stack/ble_stack.html">18. BLE</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../API/sys/cronalarms.html">1. cronalarms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/wifi/wifi_mgmr.html">2. Wi-Fi Manager</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README/README.html">1. Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Orphaned Pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bl602doc_tool/index.html">1. Dev Cube 用户手册</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BL602 IoT SDK (Pine64 fork)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">17. </span>UART_echo</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/Examples/demo_peripherals_uart_echo/uart_echo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="uart-echo">
<span id="uart-echo-index"></span><h1><span class="section-number">17. </span>UART_echo<a class="headerlink" href="#uart-echo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2><span class="section-number">17.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This example explains the process of sending received data back to the sender via UART1.</p>
</div>
<div class="section" id="usage-steps">
<h2><span class="section-number">17.2. </span>Usage Steps<a class="headerlink" href="#usage-steps" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Prepare a <code class="docutils literal notranslate"><span class="pre">USB</span> <span class="pre">to</span> <span class="pre">TTL</span></code> cable, and configure the <code class="docutils literal notranslate"><span class="pre">uart</span></code> in the SDK directory at <code class="docutils literal notranslate"><span class="pre">bl_iot_sdk/tools/flash_tool/bl602/device_tree/bl_factory_params_evb_40M.dts</span></code>. For this, refer to the following example configuration.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  uart {
      #address-cells = &lt;1&gt;;
      #size-cells = &lt;1&gt;;
      uart@4000A000 {
          status = &quot;okay&quot;;
          id = &lt;0&gt;;
          compatible = &quot;bl602_uart&quot;;
          path = &quot;/dev/ttyS0&quot;;
          baudrate = &lt;2000000&gt;;
          pin {
              rx = &lt;7&gt;;
              tx = &lt;16&gt;;
          };
          feature {
              tx = &quot;okay&quot;;
              rx = &quot;okay&quot;;
              cts = &quot;disable&quot;;
              rts = &quot;disable&quot;;
          };
      };
      uart@4000A100 {
          status = &quot;okay&quot;;
          id = &lt;1&gt;;
          compatible = &quot;bl602_uart&quot;;
          path = &quot;/dev/ttyS1&quot;;
          baudrate = &lt;115200&gt;;
          pin {
              rx = &lt;3&gt;;
              tx = &lt;4&gt;;
          };
          feature {
              tx = &quot;okay&quot;;
              rx = &quot;okay&quot;;
              cts = &quot;disable&quot;;
              rts = &quot;disable&quot;;
          };
      };
  };

- Steps to use：
  - Connect the board&#39;s ``gpio3`` and ``gpio4`` and ``GND`` to the ``TXD``, ``RXD``, and ``GND`` of the ``USB to TTL`` serial cable, respectively.
  - Compile ``customer_app/sdk_app_uart_echo`` and flash the image.
  - Open two serial terminal windows (A and B, respectively), with the Baud rate for A set to 115200, and the Baud rate for B set to2000000. After powering on the board, you can see that window A has received ``1234567890abcdefg``, while window B is stuck at ``send case``. You can continue the program by typing ``1234567890abcdefg`` in window A (note that there is no echo), after which B should continue to ``recv case`` and ``end``.
</pre></div>
</div>
<div class="figure align-default">
<img alt="" src="../../_images/image114.png" />
</div>
<div class="figure align-default">
<img alt="" src="../../_images/image213.png" />
</div>
</div>
<div class="section" id="code-examples">
<h2><span class="section-number">17.3. </span>Code Examples<a class="headerlink" href="#code-examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">aos_write()</span></code> to send data to the terminal using UART1, and then wait terminal to return the received data. Upon receiving the same data as the one sent, the log port will print the contents of the message.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aos_write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">send_recv_log</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">send_recv_log</span><span class="p">));</span>
<span class="n">log_step</span><span class="p">(</span><span class="n">ci_table_step_send</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">aos_read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf_recv</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">send_recv_log</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">!=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">send_recv_log</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf_recv</span><span class="p">,</span> <span class="n">send_recv_log</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">send_recv_log</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;recvbuff:</span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">send_recv_log</span><span class="p">);</span>
        <span class="n">log_step</span><span class="p">(</span><span class="n">ci_table_step_recv</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">log_step</span><span class="p">(</span><span class="n">ci_table_step_end</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">void</span> <span class="pre">aos_loop_proc(void</span> <span class="pre">*pvParameters)</span></code> at <code class="docutils literal notranslate"><span class="pre">customer_app/sdk_app_uart_echo/sdk_app_uart_echo/main.c</span></code>, ci_loop_proc is called to create the <code class="docutils literal notranslate"><span class="pre">uart_echo</span></code> task.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../demo_peripherals_uart_ioctl/uart_ioctl.html" class="btn btn-neutral float-right" title="18. UART_ioctl" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../demo_peripherals_gpio/GPIO.html" class="btn btn-neutral float-left" title="16. GPIO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Bouffalo Lab, volunteers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>